<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Study Projects</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f4f6f8; margin: 0; padding: 40px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px Gist Codenames, 'Roboto Mono', monospace; }
        h1 { border-bottom: 1px solid #eee; padding-bottom: 15px; }
        #project-list { list-style-type: none; padding: 0; }
        .project-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px; transition: box-shadow 0.2s; }
        .project-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .project-item a { text-decoration: none; color: #007bff; font-weight: bold; font-size: 1.1em; }
        #new-project-form { margin-top: 30px; display: flex; gap: 10px; }
        #new-project-form input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; }
        #new-project-form button { padding: 10px 20px; border: none; background-color: #28a745; color: white; border-radius: 5px; cursor: pointer; font-size: 1em; }
    </style>
</head>
<body>
    <div class="container">
        <h1>My Study Projects</h1>
        <ul id="project-list"></ul>
        <div id="loader" style="display: none;">Loading...</div>

        <form id="new-project-form">
            <input type="text" id="project-name" placeholder="New project name (e.g., Biology Midterm)" required>
            <button type="submit">Create New Project</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const projectList = document.getElementById('project-list');
            const newProjectForm = document.getElementById('new-project-form');
            const projectNameInput = document.getElementById('project-name');
            const loader = document.getElementById('loader');

            async function loadProjects() {
                loader.style.display = 'block';
                projectList.innerHTML = '';
                const response = await fetch('/get-projects');
                const projects = await response.json();
                loader.style.display = 'none';

                if (projects && projects.length > 0) {
                    projects.forEach(project => {
                        const li = document.createElement('li');
                        li.className = 'project-item';
                        li.innerHTML = `<a href="/workspace/${project.id}">${project.name}</a>`;
                        projectList.appendChild(li);
                    });
                } else {
                    projectList.innerHTML = '<p>No projects yet. Create one below!</p>';
                }
            }

            newProjectForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const projectName = projectNameInput.value.trim();
                if (!projectName) return;

                const response = await fetch('/create-project', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: projectName })
                });
                const result = await response.json();

                if (result.success) {
                    projectNameInput.value = '';
                    await loadProjects();
                } else {
                    alert('Error creating project: ' + result.error);
                }
            });

            loadProjects();
        });
    </script>
</body>
</html>